<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${book != null} ? ${book.bookName} + ' | Audiobook' : 'Audiobook'">Audiobook</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">

    <!-- Page-specific CSS saved inside template as requested -->
    <style>
        :root {
            --bg: #0e1116;
            --fg: #e6e6e6;
            --muted: #a7b0b8;
            --primary: #6ea8fe;
            --card: #161b22;
            --accent: #9b59b6;
            --danger: #ff6b6b;
            --success: #2ecc71;
            --border: #263040;
            --shadow: rgba(0,0,0,0.35);
        }
        body { background: var(--bg); color: var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
        a { color: var(--primary); text-decoration: none; }
        a:hover { text-decoration: underline; }

        header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); background: #0b0f14;
            position: sticky; top: 0; z-index: 10;
        }
        header h1 { font-size: 1.25rem; margin: 0; color: #fff; }
        header nav ul { list-style: none; display: flex; gap: 1rem; padding: 0; margin: 0; }
        header nav a { color: #c9d1d9; font-weight: 500; }

        .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }

        .book-card {
            display: grid; grid-template-columns: 280px 1fr; gap: 1.5rem; padding: 1.25rem;
            background: var(--card); border: 1px solid var(--border); border-radius: 12px;
            box-shadow: 0 10px 30px var(--shadow);
        }
        .cover-wrap { position: relative; }
        .cover {
            width: 100%; height: 100%; max-height: 420px; object-fit: cover; border-radius: 10px;
            border: 1px solid var(--border); box-shadow: 0 10px 20px var(--shadow);
        }
        .badge {
            position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6);
            color: #ffd166; padding: 0.3rem 0.6rem; border-radius: 8px; font-size: 0.8rem;
            border: 1px solid var(--border);
        }

        .meta h2 { margin: 0 0 0.5rem; font-size: 1.8rem; color: #fff; }
        .author {
            display: flex; align-items: center; gap: 0.75rem; color: var(--muted);
            margin-bottom: 0.75rem;
        }
        .author img { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 1px solid var(--border); }
        .genre { color: #8ab4f8; font-weight: 600; letter-spacing: 0.3px; margin-bottom: 0.75rem; }
        .desc { color: #cdd6df; line-height: 1.6; }

        .actions { margin-top: 1rem; display: flex; gap: 0.75rem; }
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 0.9rem; border-radius: 8px; border: 1px solid var(--border); background: #11161d; color: #e6eef6; font-weight: 600; }
        .btn:hover { background: #0f141b; text-decoration: none; }
        .btn.primary { background: linear-gradient(135deg, #6ea8fe, #5f9bff); border-color: #4a7fd3; color: #0b1220; }
        .btn.primary:hover { filter: brightness(1.05); }

        .section { margin-top: 2rem; }
        .section h3 { margin: 0 0 1rem; font-size: 1.2rem; color: #fff; }

        .reviews { display: grid; gap: 0.75rem; }
        .review { background: #11161d; border: 1px solid var(--border); border-radius: 10px; padding: 0.9rem; display: grid; grid-template-columns: 44px 1fr; gap: 0.9rem; }
        .review .avatar { width: 44px; height: 44px; border-radius: 50%; object-fit: cover; border: 1px solid var(--border); }
        .review .header { display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; }
        .review .user { color: #e6eef6; font-weight: 600; }
        .review .stars { color: #ffd166; letter-spacing: 1px; font-size: 0.95rem; }
        .review .comment { color: #c9d1d9; margin-top: 0.35rem; }

        .empty { color: var(--muted); }

        .back { margin-top: 1.5rem; display: inline-block; }

        @media (max-width: 820px){
            .book-card { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<header>
    <h1><a th:href="@{${routes.home}}" style="text-decoration:none; color:#fff;">Audiobook Store</a></h1>
    <nav>
        <ul>
            <li><a th:href="@{${routes.home}}">Catalog</a></li>
            <li><a th:href="@{/}">Uploads</a></li>
        </ul>
    </nav>
</header>

<main class="container" th:with="b=${book}">
    <!-- Guard if book not present -->
    <div th:if="${b} == null" class="empty">Book not found.</div>

    <section th:if="${b} != null" class="book-card">
        <div class="cover-wrap">
            <img class="cover" th:src="@{${routes.files + b.bookCover}}" alt="Book cover">
            <span class="badge" th:text="${b.bookGenre}">GENRE</span>
        </div>
        <div class="meta">
            <h2 th:text="${b.bookName}">Book Title</h2>
            <div class="author">
                <img th:if="${b.author != null}" th:src="@{${routes.files + b.author.author_image}}" alt="Author">
                <div>
                    <div th:text="${b.author != null ? b.author.name : 'Unknown Author'}">Author Name</div>
                </div>
            </div>
            <div class="genre" th:text="${b.bookGenre}">Fantasy</div>
            <div class="desc" th:text="${b.description}">Description...</div>

            <div class="actions">
                <a class="btn" th:href="@{${routes.home}}">Back to catalog</a>
                <a class="btn primary" th:href="@{${routes.files + b.bookCover}}" download>
                    Download Cover
                </a>
                <a class="btn primary" th:href="@{${routes.adminBooks + '/edit/' + b.id}}">
                    Edit
                </a>
            </div>
        </div>
    </section>

    <section class="section">
        <h3>Reviews</h3>
        <div class="reviews" th:if="${reviews != null and !#lists.isEmpty(reviews)}">
            <article class="review" th:each="r : ${reviews}">
                <img class="avatar" th:if="${r.user != null and r.user.image != null}" th:src="@{/files/{img}(img=${r.user.image})}" alt="User">
                <div>
                    <div class="header">
                        <span class="user" th:text="${r.user != null ? r.user.username : 'Anonymous'}">Username</span>
                        <span class="stars" th:with="g=${r.grade != null ? r.grade.value : 0}">
                            <span th:each="i : ${#numbers.sequence(1,5)}"
                                  th:text="${i <= g} ? '★' : '☆'">★</span>
                        </span>
                    </div>
                    <div class="comment" th:text="${r.comment}">Loved it!</div>
                </div>
            </article>
        </div>
        <div class="empty" th:if="${reviews == null or #lists.isEmpty(reviews)}">No reviews yet.</div>
    </section>

    <a class="back" th:href="@{${routes.home}}">← Back to catalog</a>
</main>

<footer style="margin: 2rem 0; text-align: center; color: #6b7682;">
    <p>&copy; 2025 Audiobook Store</p>
</footer>
</body>
</html>
